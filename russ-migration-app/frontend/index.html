<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Russ Analyser | RUSS Consultancy</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <header class="header">
        <img src="/static/assets/russ_logo-removebg-preview.png" alt="RUSS Consultancy Logo" class="logo" />
        <div class="header-content">
            <h1>RUSS Analyser</h1>
            <p class="tagline">Performance-Driven Migration Assessment Tool</p>
        </div>
    </header>

    <main class="main-content">
        <section class="upload-card">
            <h2>üì§ Step 1: Upload Your AWR Reports</h2>
            <form id="uploadForm">
                <label for="cloud">Select Cloud Platform:</label>
                <select id="cloud" name="cloud" required>
                    <option value="">-- Choose Cloud --</option>
                    <option value="azure">Azure</option>
                    <option value="aws">AWS</option>
                </select>

                <label for="files">Select AWR HTML Files:</label>
                <input type="file" id="files" name="files" accept=".html,.htm" multiple required>

                <button type="submit" class="btn blue">Analyze</button>
            </form>

            <div id="status-message" class="status-message"></div>
        </section>
    </main>

    <footer class="footer">
        ¬© 2025 RUSS Consultancy Services | Experience At Work
    </footer>

    <script>
        const form = document.getElementById("uploadForm");
        const statusMsg = document.getElementById("status-message");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const cloud = document.getElementById("cloud").value;
            const files = document.getElementById("files").files;

            if (!cloud || files.length === 0) {
                statusMsg.innerHTML = "<span class='error'>‚ö†Ô∏è Please select a cloud and upload files.</span>";
                return;
            }

            const formData = new FormData();
            formData.append("cloud", cloud);
            for (const file of files) {
                formData.append("files", file);
            }

            statusMsg.innerHTML = "<div class='loader small'></div><p>Uploading and analyzing reports...</p>";

            try {
                // Upload step
                const uploadRes = await fetch("/upload-awrs", {
                    method: "POST",
                    body: formData,
                });
                const uploadData = await uploadRes.json();
                if (uploadData.status !== "uploaded") throw new Error(uploadData.message || "Upload failed");

                // Analyze step
                const analyzeRes = await fetch("/analyze", {
                    method: "POST",
                    body: new URLSearchParams({ cloud }),
                });
                const analyzeData = await analyzeRes.json();

                if (analyzeData.status === "ok") {
                    statusMsg.innerHTML = "<span class='success'>‚úÖ Analysis complete! Redirecting to dashboard...</span>";
                    setTimeout(() => window.location.href = "/dashboard.html", 1200);
                } else {
                    throw new Error(analyzeData.message || "Analysis failed");
                }
            } catch (err) {
                statusMsg.innerHTML = `<span class='error'>‚ùå ${err.message}</span>`;
            }
        });
    </script>
</body>

</html>